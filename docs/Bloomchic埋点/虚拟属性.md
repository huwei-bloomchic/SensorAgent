# 虚拟属性

| 属性英文变量名（必填） | 属性显示名（必填） | 数据类型（必填） | 属性值说明或示例 | 设置时机（必填） | 备注 |
| --- | --- | --- | --- | --- | --- |
| is_spider_ip | 是否疑似爬虫IP | STRING |  | SQL虚拟属性 | 根据`$ip`字段前3段判断是否为疑似爬虫IP (AND模式) |
| ip_prefix | IP前3段 | STRING |  | SQL虚拟属性 | 提取`$ip`字段的前3段 (AND模式) |
| url_utm_source | $url中的utm_source | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`url`/`$url`解析utm_source参数 (OR模式) |
| url_utm_medium | $url中的utm_medium | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`url`/`$url`解析utm_medium参数 (OR模式) |
| url_utm_campaign | $url中utm_campaign | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`url`/`$url`解析utm_campaign参数 (OR模式) |
| url_bc_id | url_bc_id | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`url`/`$url`解析bc_id参数 (OR模式) |
| CollectionHandle | CollectionHandle | STRING |  | SQL虚拟属性 | 根据`web_platform_type`从`$url`提取或使用`collection_handle` (OR模式) |
| item_product_tags | 商品标签 | LIST |  | SQL虚拟属性 | 需要`product_id`关联items表获取`tags`字段 (AND模式) |
| item_product_category | 商品类目 | STRING |  | SQL虚拟属性 | 需要`product_id`关联items表获取`category`字段 (AND模式) |
| item_product_handle | 商品handle | STRING |  | SQL虚拟属性 | 需要`product_id`关联items表获取`handle`字段 (AND模式) |
| item_product_current_price | 最新商品现价 | NUMBER |  | SQL虚拟属性 | 需要`product_id`关联items表获取`current_price`字段 (AND模式) |
| item_product_origin_price | 最新商品原价 | NUMBER |  | SQL虚拟属性 | 需要`product_id`关联items表获取`origin_price`字段 (AND模式) |
| item_comment_count | 最新商品评论数 | NUMBER |  | SQL虚拟属性 | 需要`product_id`关联items表获取`comment_count`字段 (AND模式) |
| item_comment_rating | 商品评分 | NUMBER |  | SQL虚拟属性 | 需要`product_id`关联items表获取`comment_rating`字段 (AND模式) |
| item_discount | 最新商品折扣金额 | NUMBER |  | SQL虚拟属性 | 需要`product_id`关联items表获取`discount`字段 (AND模式) |
| is_new_order_users | 新老订单用户-自然日 | STRING |  | SQL虚拟属性 | 根据`first_order_time`与`events.time`自然日差判断新老用户 (AND模式) |
| is_new_visit_users | 新访问用户 | STRING |  | SQL虚拟属性 | 根据`$first_visit_time`与`events.time`时间差判断新老访问 (AND模式) |
| user_member_level | 用户等级 | STRING |  | SQL虚拟属性 | 根据`become_member_1/2/3_time`与`events.time`判断会员等级 (AND模式) |
| lastest_member_level | 用户最新会员等级 | STRING |  | SQL虚拟属性 | 直接获取`member_level`字段 (AND模式) |
| format_media_url | format_media_url | STRING |  | SQL虚拟属性 | 格式化`media_url`字段，补全协议头 (AND模式) |
| item_details_season | 商品季节 | STRING |  | SQL虚拟属性 | 需要`product_id`关联items表获取`details_season`字段 (AND模式) |
| is_new_order_users_2 | 新老订单用户-24H | STRING |  | SQL虚拟属性 | 根据`first_order_time`与`events.time`24小时差判断新老用户 (AND模式) |
| url_utm_content | url中的utm_content | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`url`/`$url`解析utm_content参数 (OR模式) |
| product_page_module_collection | 商品曝光来源 | STRING |  | SQL虚拟属性 | 拼接`page_code`、`module_name`、`collection_handle` (OR模式) |
| item_publish_day | 商品发布天数 | NUMBER |  | SQL虚拟属性 | 需要`product_id`关联items表，根据`pub_time`与`events.time`计算天数 (AND模式) |
| click_url_handle | ClickUrl的Handle | STRING |  | SQL虚拟属性 | 从`click_url`字段正则提取handle (AND模式) |
| combine_recommend_size | 推荐尺码 | STRING |  | SQL虚拟属性 | 优先使用`recommended_size`否则使用`recommend_size` (OR模式) |
| latest_ad_bc_id | 最近bc_id | STRING |  | SQL虚拟属性 | 从`latest_ad_landing_page`解析bc_id参数 (AND模式) |
| fixed_latest_fb_ad_url | 修复FB最近广告链接 | STRING |  | SQL虚拟属性 | 优先使用`fb_latest_ad_landing_page`否则用`latest_ad_landing_page` (OR模式) |
| latest_ad_visit_hours | 最近点击广告小时数 | NUMBER |  | SQL虚拟属性 | 根据`latest_ad_time`与`events.time`计算小时数 (AND模式) |
| resource_module_index | 模块中的位置 | NUMBER |  | SQL虚拟属性 | 从`web_module_number`提取小数部分计算位置 (AND模式) |
| handle_in_url | url中的handle | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`url`/`$url`路径正则提取handle (OR模式) |
| fixed_site_code | 站点标识 | STRING |  | SQL虚拟属性 | 根据`time`和`site_code`字段修复站点标识 (OR模式) |
| path_in_url | url中的path | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`$url`解析PATH (OR模式) |
| product_discount_percent | 商品折扣率 | NUMBER |  | SQL虚拟属性 | 根据`web_current_price`和`web_original_price`计算折扣率 (AND模式) |
| item_latest_sale_country_list | 商品最新销售地区 | LIST |  | SQL虚拟属性 | 需要`product_id`关联items表获取`sales_country_list`字段 (AND模式) |
| user_is_new_order_users | 新老订单用户 | STRING |  | SQL虚拟属性(用户表) | 根据`first_order_time`与当前时间自然日差判断新老用户 (AND模式) |
| is_preorder_product | 预售商品 | BOOL |  | SQL虚拟属性 | 根据`preorder_left_date`>2判断是否为预售 (AND模式) |
| item_cate_1 | 商品一级品类 | STRING |  | SQL虚拟属性 | 需要`product_id`关联items表获取`cate_1`字段 (AND模式) |
| item_cate_2 | 商品二级品类 | STRING |  | SQL虚拟属性 | 需要`product_id`关联items表获取`cate_2`字段 (AND模式) |
| item_cate_3 | 商品三级品类 | STRING |  | SQL虚拟属性 | 需要`product_id`关联items表获取`cate_3`字段 (AND模式) |
| extra_spu_from_sku | 修复SPU(从SKU中提取) | STRING |  | SQL虚拟属性 | 从`product_sku`前14位提取SPU (AND模式) |
| fixed_fp_id | 修复fp_id | STRING |  | SQL虚拟属性 | 根据`b_fp`、`fp_id`、`$url`、`$device_id`修复fp_id (AND模式) |
| user_ages | 用户年龄 | NUMBER |  | SQL虚拟属性(用户表) | 根据`birth_date`与当前时间计算年龄 (AND模式) |
| product_size_code | 商品尺码Code | STRING |  | SQL虚拟属性 | 从`product_sku`后3位映射尺码代码 (AND模式) |
| is_spider_user | 爬虫用户 | STRING |  | SQL虚拟属性 | 根据`$country`、`$bot_name`、`$user_agent`、`$ip`判断爬虫 (OR模式) |
| host_in_url | url中的HOST | STRING |  | SQL虚拟属性 | 从`$deeplink_url`/`url`/`$url`解析HOST (OR模式) |
| total_us | 除税合计Dollar | NUMBER |  | SQL虚拟属性 | 根据`site_code`、`total`、`tax`计算美元金额 (OR模式) |
| app_version_short | APP版本(2位) | STRING |  | SQL虚拟属性 | 从`$app_version`提取前两位版本号 (AND模式) |

